# Average Salary: Departments VS Company
# %Y indicates 4 digit, %m indicates number rather than month name
# never forget 'on'

select a2.pay_month, a2.department_id, 
case when d_avg < c_avg, then 'lower'
     when d_avg > c_avg, then 'higher'
     else 'same'
end as comparison
from 
(select date_format(pay_date,'%Y-%m') as pay_month, department_id, avg(amount) as d_avg
 from salary, employee
 where salary.employee_id = employee.employee_id
 groupby pay_month, department_id
) as a2
join
(
select avg(amount) as c_avg,date_format(pay_date,'%Y-%m') as pay_month
from salary
group by pay_month
) as a1
on a2.pay_month = a1.pay_month
;
